# FULLTEXTインデックスの簡単な説明

### 目的
FULLTEXTインデックスというものをざっくり理解してもらう

### 形式
理解の踏み台になるように、公式ドキュメントより簡単に説明する

### まえがき
FULLTEXTインデックスはMySQLの機能の1つですが、参考記事を探しても簡単な解説が見つからなかったた本記事を書くことにしました。<br>
公式ドキュメントを初見で理解できる方は以下リンクからどうぞ。

[MySQL :: MySQL 8.0 リファレンスマニュアル :: 15.6.2.4 InnoDB FULLTEXT インデックス](https://dev.mysql.com/doc/refman/8.0/ja/innodb-fulltext-index.html)

### 免責
概要を理解していただくことを重視するため、「基本的に」や「～など」といった語をつけた方が正しい内容でもあえて省略して、一例だけ説明します。
なんとなく理解できた方は公式ドキュメントに目を通すことを強く推奨いたします(←自戒も込めて記載)。

### 本編
ドキュメント冒頭を簡単な表現で補足します：

> FULLTEXT インデックスは、テキストベースのカラム (CHAR、VARCHAR または TEXT カラム) に作成され、

→ カラム(テーブルの列)の型は用途に応じてINT型, DATETIME型などありますが、FULLTEXT インデックスは文字列に対応した型のカラムの検索を高速化するために作成できます

> それらのカラムに含まれるデータに対するクエリーおよび DML 操作を高速化し、

→ FULLTEXT インデックスを作成しておくと、カラムの値(文字列)を検索対象としてレコードを抽出する処理を何倍か高速化できます。抽出するときの処理の下準備が済んだ状態を常に維持/最新化しておくイメージです。

> ストップワードとして定義されている単語を省略します。 

→ ストップワードとは、英語のインデックスを効率よく作成するためのブラックリストのようなものです。デフォルトでは英単語としてはそこまでユニークな意味を持たない a, the, in, it などの36単語がストップワードとして登録されています。
#### 注意1「ストップワードは不要かもしれません」
たとえばデフォルトのストップワードを用いて"1年A組17番"といった文字列のFULLTEXT インデックスを生成すると、"A"を含むインデックスは生成されずそれ以外の一部を切り取った"組17", "17番", "組17番"しか生成されません。

すると"1年A組"のように'A'を含む値を抽出しようとしても1件もヒットしないということが起きてしまいます。

このように英文以外の値が想定される場合は、ストップワードを用いた機能は不要なため、何も指定しないように設定変更が必要です。

参考：[MySQL :: MySQL 8.0 リファレンスマニュアル :: 12.10.4 全文ストップワード](https://dev.mysql.com/doc/refman/8.0/ja/fulltext-stopwords.html)

#### FULLTEXT インデックスの実体と処理
FULLTEXT インデックスの生成は、"1年A組17番"といった文字列の一部を切り取って"組17", "17番", "組17番"のようなパーツに分けて、それぞれがどの位置に存在するかを表形式でまとめておく処理です。

FULLTEXT インデックス自体を設定したときに作成され、対象の値が更新される度に更新されます。

#### 注意2「2文字または1文字でも検索できるようにするためには」
MySQLでInnoDBというストレージエンジンを採用している場合、デフォルト設定では3文字以上のFULLTEXT インデックスしか生成されません。

ストップワードと似た考え方で、英文のFULLTEXT インデックスを生成する場合は2文字以下の文字列で検索できなくていいという意図が感じられます。

2文字または1文字でも検索できるようにするためには、ngram パーサーを有効にした上でngram_token_size オプションを2または1にしてください。

→ もう少しわかりやすく書くと、

> 「デフォルトのパーサー(文字列の区切りを見つけて分解する機能)は英文を想定していて半角スペース、カンマ、ピリオドで区切った単語をインデックスとして生成します。<br><br>
しかし英文以外の文字列を想定する場合はこのような目印をアテにするのではなく、指定した文字数で切り出してインデックスを作成したい場合は設定を変更したほうがいいです。<br><br>
まずデフォルトのパーサーではなくngram パーサーを有効にします。<br>
そしてngram_token_sizeという設定値を2または1にしてください。<br><br>
こうすることで2文字または1文字のインデックスが生成され、2文字または1文字の検索語で検索が可能になります。

#### まとめ
FULLTEXTインデックスは便利ですが、英文を想定した初期設定になっているため対象文字列の形式によっては設定変更が必要かもしれません。